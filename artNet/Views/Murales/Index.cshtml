 @model IEnumerable<artNet.Models.MuralViewModel>
    @{
        Layout = null;
    }
    @{
        ViewData["Title"] = "Murales";
    }

    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <title>Feed</title>
        <link href="~/css/Feed.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    </head>
    <body>
        <div class="principal-container">
        <div class="explorer-container">
            <h1 class="figura">ArtNet</h1>
            <div class="d-flex align-items-center" style="font-size: 20px">
                <i class="bi bi-house-door-fill me-2"></i> Inicio
            </div>
            
            <div class="d-flex align-items-center" style="font-size: 20px">
                <i class="bi bi-search me-2"></i> Buscar
            </div>
            <div class="nav-item" style="font-size: 20px">
                <i class="bi bi-person-circle"></i> Perfil
            </div>
        </div>
        <div class="images-container">
            @if (Model.Any())
            {
                @foreach (var mural in Model)
                    {

                    <img src="@mural.UrlImagen"
                        alt="@mural.Nombre"
                        class="feed-image"
                        style="cursor:pointer; border: solid 1px #ffffff;"
                        data-id="@mural.Id"
                        onclick="mostrarDetalles(this)" />

                    <!-- Iconos de corazon y comentarios -->
                    <div class="icons-feed">
                        <i class="bi bi-heart" style="font-size: 2rem; color: #e74c3c; cursor: pointer;"></i>
                        <i class="bi bi-chat" style="font-size: 2rem; color: #007bff; cursor: pointer;"></i>

                    </div>

                    }
                

            }
            else
            {
               <p>No hay murales para mostrar.</p>
            }
        </div>
    </div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let muralIdActual = null;

        function mostrarDetalles(img) {
            const id = img.getAttribute("data-id");
            muralIdActual = id;

            fetch(`/Details/GetDetails?id=${id}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("modalImagen").src = data.urlImagen;
                    document.getElementById("modalNombre").innerText = data.nombre;
                    document.getElementById("modalDescripcion").innerText = data.descripcion;
                    document.getElementById("modalCiudad").innerText = data.ciudad;

                    actualizarComentarios(data.comentarios);

                    const modal = new bootstrap.Modal(document.getElementById('detalleModal'));
                    modal.show();
                });
        }

        function actualizarComentarios(comentarios) {
            const lista = document.getElementById("comentariosLista");
            lista.innerHTML = "";

            if (comentarios.length === 0) {
                lista.innerHTML = "<li>No hay comentarios.</li>";
            } else {
                comentarios.forEach(c => {
                    const li = document.createElement("li");
                    li.innerHTML = `<strong>${c.usuario}</strong> (${new Date(c.fecha).toLocaleString()}): ${c.contenido}`;
                    lista.appendChild(li);
                });
            }
        }

        function enviarComentario() {
            const texto = document.getElementById("comentarioTexto").value.trim();
            if (!texto) return alert("Comentario vacío");

            fetch('/Details/AgregarComentario', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    muralId: muralIdActual,
                    contenido: texto
                })
            })
            .then(resp => {
                if (!resp.ok) throw new Error("No se pudo guardar el comentario");
                return resp.json();
            })
            .then(comentariosActualizados => {
                document.getElementById("comentarioTexto").value = "";
                actualizarComentarios(comentariosActualizados);
            })
            .catch(err => {
                console.error(err);
                alert("Hubo un problema al guardar el comentario.");
            });
        }
    </script>


    </body>
</html>

<!-- Modal para detalles -->
<div class="modal fade" id="detalleModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Detalles del Mural</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Cerrar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <img id="modalImagen" src="" class="img-fluid mb-3 rounded" alt="Imagen del mural" />
                <p><strong>Nombre:</strong> <span id="modalNombre"></span></p>
                <p><strong>Descripción:</strong> <span id="modalDescripcion"></span></p>
                <p><strong>Ciudad:</strong> <span id="modalCiudad"></span></p>
                <div id="comentariosContainer">
                    <h5>Comentarios:</h5>
                    <ul id="comentariosLista" class="list-unstyled">
                        <!-- Comentarios se insertarán aquí por JavaScript -->
                    </ul>
                </div>
                <div class="mt-3">
                    <h5>Agregar Comentario</h5>
                    <textarea id="comentarioTexto" class="form-control mb-2" placeholder="Escribe tu comentario aquí"></textarea>
                    <button class="btn btn-primary" onclick="enviarComentario()">Publicar</button>
                </div>

            </div>
        </div>
    </div>
</div>


